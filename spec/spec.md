# GitHub Diary Spec

GitHub Diaryは、GitHubプラットフォームを用いて日記を管理するデスクトップアプリケーションです。

## アーキテクチャ

```

USER -> This app (Desktop) -(GraphQL or REST API)-> GitHub

```

## 機能要件

### 共通ヘッダー

- 左側に「今日」ボタンがあり、それをおすとカレンダーページの今日の日付に移動する
- 右側にsyncボタンがあり、それを押すと現在のページに対して、最新の表示データをGitHubから取得する
- その右側に設定ボタンがあり、GitHubトークンの管理や、リポジトリの指定などを行える
- 共通ヘッダーは全てのページで常時表示され、設定ボタンを押すと設定ページに遷移する

### カレンダーページ

- カレンダーで月ごとの日付を一覧できる（[Google CalendarライクなUI](calendar.png)でOK）
- カレンダーは日曜始まり
- カレンダーで月を切り替えることができる
- APIを利用し、その月分の日記を取得しておく
- 月を切り替えるたびに新しく取得する
- アプリケーション起動時は、その日の月を表示する
- 今日が何日か分かる
- どの日付に日記を書いていないか確認できる
- 今日の日記を書いていないかを確認できる（画面上部にメッセージが表示される）
  - すでに執筆している場合、カレンダーのエリアに鉛筆アイコンが表示される
- 日付を押すと、すでに日記が書いてある場合は日記プレビューページへ、書いてなければ日記編集ページへ飛ぶ
- GitHubのトークンやリポジトリの指定がされていない場合、ここでは「設定を行なってください」というメッセージを表示する

### 日記プレビューページ

- [GitHubのREADME.mdファイルプレビュー](diary_preview.png)と似た形でOK
- 右側に鉛筆アイコンを置き、それを押すと日記編集ページへ飛ぶ
- 左側に左矢印アイコンを押し、それを押すとカレンダーページに戻る
- GitHubの指定されたリポジトリのmainブランチから`yyyy/MM/dd/README.md`を取得する。
  - 存在しなければ、日記編集ページへ飛ぶ 
- 取得されたマークダウンを、GFMに従って表示する

### 日記編集ページ

- [GitHubのエディタ画面](diary_edit.png)と似た形でOK
- エディタ画面
- GitHubの指定されたリポジトリから`yyyy/MM/dd/README.md`を取得する。
  - 存在しなければ、現在の日付のみ（`# yyyy/MM/dd (ddd)`形式）をあらかじめ入れておく
  - 存在すれば、その内容をエディタ画面に入れる
- 右側の「Save」ボタンを置き、それを押すと現在の内容を保存する。
- GitHubと同程度の、マークダウンをサポートするエディタ機能をもつ
  - 例えば、itemize (`-`)がある状態で改行すると、文頭に`- `が入る 
- 保存には、PUT `https://api.github.com/repos/{owner}/{repo}/contents/{path}` が使えそうですが、何が適当かは別途調べる。
- 保存する際には、`yyyy/MM/dd/README.md`というファイル名でmainブランチに保存する
- コンフリクトが発生した際には、その旨をエラーメッセージとして表示する
- 保存したら、日記プレビューページへ飛ぶ
- ドラフト保存は可能であれば実装するが、Saveボタンを押すまでリクエストは送らない
- エディタ上でのプレビュー機能は不要
- テキストのみでOK
- コミットメッセージは`yyyy/MM/dd`

### 設定ページ

- 2つの設定がある。
- GitHubトークンの管理
  - OAuthかPAT
  - GitHubページに飛び、ログイン等の認証をすることで、必要なトークンを取得する
  - トークンはローカルに保存する。暗号化などのセキュリティやポータビリティについては考えなくて良い
  - 必要スコープ（PAT）
    - fine-grained: 対象リポジトリに対する Contents: Read/Write を付与
    - classic: `repo`（プライベートリポを扱うため）
  - PAT取得フロー
    1. 「PATで認証」ボタンを押下
    2. 外部ブラウザで `https://github.com/settings/tokens` （fine-grained推奨）を開く
    3. ユーザが生成したPATをアプリに貼り付けて保存
    4. 保存時に`GET /user`で疎通確認し、成功したら暗号化してローカル保存
    5. 失効や権限不足をAPIの401/403で検知し、再入力を促す
- リポジトリの指定
  - GitHubのリポジトリ
  - `org/repo`の形式
  - リポジトリは必ず既存のリポジトリが指定される
- GitHubと同じUIでOK

### その他

- タイムゾーンはJST
- 常にオンラインであると仮定して良い。オフラインで通信エラーが発生した場合、その旨を画面に表示する
- ローディング中はloading indicatorを表示する
- モーダルは不要

## 技術要件

以下の技術を使ってください

- プログラミング言語: Kotlin
- プロジェクト管理: Gradle
- UI: Jetpack Compose
  - KMP for Desktop (JVMでOK)
  - MacOSのみのサポート
- GitHub API (GraphQL or REST)
  - REST APIを利用する場合はKtor client
  - GraphQLの場合は、適当なライブラリ
- テスト: JUnit 6
